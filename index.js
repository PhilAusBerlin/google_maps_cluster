

// Request needed libraries.
const { Map, InfoWindow } = await google.maps.importLibrary("maps");

const { AdvancedMarkerElement, PinElement } = await google.maps.importLibrary(
    "marker",
);

const infoWindow = new google.maps.InfoWindow({
  disableAutoPan: true,
});

async function initMap(data) {
  let locations_dl_staedte = data;

  const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 7,
    center: { lat: 52.52, lng: 13.405 },
    mapId: "547b87d97049c441",
  });


  const markers = locations_dl_staedte.map((position, i) => {
    /*console.log(position.name);
    console.log(position.district);
    console.log(position.coords.lat);
    console.log(position.coords.lon);*/
    console.log(position.population);
    position.lat = parseFloat(position.coords.lat);
    position.lng = parseFloat(position.coords.lon);
    position.pop = parseFloat(position.population);
    position.state = position.state;

    const label = position.name;

    const pTag = document.createElement("div");

    pTag.className = "pTag";
    pTag.innerHTML = "<h1>"+label+"</h1>";
  
    // [{"label":"Hamburg:100","slug":"Hamburg:100","parent":"locations"}]
    let veranstaltungString = '[{"label":"' + position.name + ':150","slug":"' + position.name + ':150","parent":"locations"}]'
    // Create Base64 Object
    var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t="";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t="";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}}

    let veranstaltungBase64 = Base64.encode(veranstaltungString);

    const contentString =
    '<div id="content">' +
    '<div id="siteNotice">' +
    "</div>" +
    '<h1 id="firstHeading" class="firstHeading">' + position.name + '</h1>' + 
    '<div id="bodyContent">' +
    '<p>Standort: lat:' + position.lat + " und lng:" + position.lng +
    "<br>Landkreis " + position.district + 
    "</p></div>" +
    "<img src='https://maps.googleapis.com/maps/api/staticmap?center=" + position.lat + "," + position.lng + "&size=200x200&key=AIzaSyAwVmpFe5xQdMl_NoENDFBHdUISdJRE-7E&zoom=10' style='width:100%'>" +
    "<p><a href='https://www.bvmw.de/de/veranstaltungen?f=" + veranstaltungBase64 + "&utm_medium=webseite&utm_campaign=null&utm_source=karte' target=_blank>BVMW Veranstaltungen</a> in " + position.name + " und Umgebung</p>" +
    "</div>";

    console.log("state: "+position.state);

    const parser = new DOMParser();
    // A marker with a custom inline SVG.
    // Farbe soll andern, basiert auf district
    const pinSvgStringWeis =
     '<svg xmlns="http://www.w3.org/2000/svg" width="50" viewBox="0 0 340.16 141.73"><g id="b"><g id="c"><path d="M140.67 72.7c-1.11 38.18-32.18 69.03-70.33 69.03S0 109.99 0 70.85 30.76 1.28 68.52 0v29.81c-21.86.74-38.93 18.83-38.93 41.04s18.24 41.06 40.75 41.06 39.93-17.24 40.72-39.21h29.61ZM74.97.04h29.55v29.77H74.97V.04Zm36.08 36.34h29.55v29.78h-29.55V36.38Zm0-36.34h29.55v29.77h-29.55V.04ZM74.97 36.38h29.55v29.78H74.97V36.38ZM160.12 29.78V0h7.04c3.45 0 6.13 1.09 8.04 3.26 1.91 2.18 2.86 5.23 2.86 9.17v4.99c0 3.94-.97 6.98-2.9 9.13-1.94 2.15-4.74 3.22-8.42 3.22h-6.62Zm3.71-26.57v23.36h2.98c2.61 0 4.52-.75 5.72-2.26 1.2-1.51 1.82-3.74 1.85-6.7v-5.28c0-3.14-.6-5.44-1.8-6.91s-3.01-2.2-5.43-2.2h-3.33ZM190.37 30.19c-2.73 0-4.83-.82-6.29-2.46-1.46-1.64-2.21-4.05-2.23-7.23v-2.68c0-3.3.71-5.89 2.14-7.76 1.43-1.87 3.42-2.81 5.98-2.81s4.49.83 5.76 2.47c1.27 1.65 1.92 4.22 1.95 7.71v2.37h-12.26v.51c0 2.37.44 4.1 1.33 5.17.89 1.08 2.16 1.62 3.83 1.62 1.06 0 1.99-.2 2.79-.6.8-.4 1.56-1.04 2.26-1.91l1.87 2.29c-1.56 2.21-3.93 3.31-7.12 3.31Zm-.41-19.84c-1.49 0-2.59.51-3.31 1.54-.72 1.03-1.12 2.63-1.22 4.8h8.65v-.49c-.09-2.1-.47-3.6-1.13-4.5-.66-.9-1.65-1.35-2.99-1.35ZM210.22 11.04c-.5-.1-1.04-.14-1.62-.14-1.84 0-3.13 1.02-3.86 3.05v15.83h-3.59V7.65h3.49l.06 2.25c.96-1.77 2.32-2.66 4.08-2.66.57 0 1.04.1 1.42.29l.02 3.52Z" fill="#ffffff"></path><path d="M160.12 121.02v-20.84h5.9c1.88 0 3.3.46 4.26 1.39.95.93 1.43 2.32 1.43 4.17 0 .97-.24 1.83-.72 2.58s-1.14 1.32-1.96 1.73c.95.29 1.7.87 2.25 1.76s.83 1.96.83 3.21c0 1.87-.51 3.34-1.53 4.41-1.02 1.07-2.47 1.6-4.35 1.6h-6.1Zm2.6-11.95h3.34c.9 0 1.63-.31 2.18-.92.55-.61.83-1.42.83-2.44 0-1.15-.25-1.98-.75-2.5s-1.27-.78-2.3-.78h-3.3v6.64Zm0 2.2v7.5h3.55c.98 0 1.77-.33 2.34-.98.58-.65.87-1.57.87-2.76 0-2.51-1.05-3.77-3.15-3.77h-3.61ZM183.48 119.65c-.83 1.1-2.05 1.65-3.65 1.65-1.39 0-2.44-.48-3.15-1.45s-1.07-2.38-1.08-4.23v-10.09h2.5v9.91c0 2.42.72 3.62 2.16 3.62 1.52 0 2.58-.69 3.15-2.06v-11.47h2.51v15.49h-2.39l-.06-1.36ZM192.08 105.52l.07 1.67c.98-1.31 2.22-1.96 3.74-1.96 2.72 0 4.1 1.83 4.14 5.48V121h-2.5v-10.18c0-1.21-.2-2.07-.6-2.58-.4-.51-1.01-.77-1.81-.77-.63 0-1.19.21-1.68.63-.5.42-.9.97-1.2 1.65V121h-2.51v-15.49h2.37ZM203.26 112.57c0-2.39.44-4.2 1.33-5.45.88-1.25 2.16-1.88 3.82-1.88 1.47 0 2.61.6 3.44 1.8v-8.02h2.51v21.99h-2.3l-.13-1.66c-.82 1.3-2 1.95-3.54 1.95s-2.84-.62-3.74-1.87c-.91-1.25-1.37-3-1.39-5.28v-1.59Zm2.51 1.44c0 1.74.26 3.01.77 3.83s1.34 1.22 2.5 1.22c1.25 0 2.18-.63 2.8-1.9v-7.81c-.64-1.24-1.57-1.86-2.78-1.86s-1.99.41-2.5 1.22-.77 2.07-.78 3.75V114ZM223.72 121.3c-1.91 0-3.38-.57-4.4-1.73-1.02-1.15-1.54-2.84-1.56-5.06v-1.88c0-2.31.5-4.12 1.5-5.43 1-1.31 2.39-1.97 4.18-1.97s3.14.58 4.04 1.73c.89 1.16 1.34 2.95 1.36 5.4v1.66h-8.58v.36c0 1.66.31 2.87.93 3.62.62.75 1.51 1.13 2.68 1.13.74 0 1.39-.14 1.95-.42.56-.28 1.09-.73 1.58-1.34l1.31 1.6c-1.09 1.55-2.75 2.32-4.99 2.32Zm-.28-13.89c-1.04 0-1.81.36-2.32 1.08-.5.72-.79 1.84-.85 3.36h6.05v-.34c-.07-1.47-.33-2.52-.79-3.15-.46-.63-1.16-.94-2.1-.94ZM239.32 117.05c0-.54-.2-1.01-.61-1.4-.41-.39-1.19-.85-2.36-1.37-1.35-.56-2.31-1.05-2.86-1.45s-.97-.86-1.24-1.37c-.28-.51-.41-1.12-.41-1.83 0-1.26.46-2.31 1.37-3.14.91-.83 2.08-1.25 3.5-1.25 1.5 0 2.7.44 3.61 1.32.91.88 1.36 2 1.36 3.38h-2.5c0-.7-.23-1.29-.7-1.78-.46-.49-1.06-.74-1.78-.74s-1.32.19-1.74.58c-.42.39-.63.9-.63 1.55 0 .51.15.93.46 1.24s1.05.73 2.22 1.24c1.87.74 3.14 1.46 3.81 2.16s1.01 1.59 1.01 2.67c0 1.35-.46 2.43-1.38 3.23-.92.81-2.15 1.21-3.69 1.21s-2.9-.46-3.89-1.39c-.99-.93-1.49-2.1-1.49-3.52h2.53c.03.86.29 1.53.78 2.02s1.18.73 2.07.73c.83 0 1.47-.19 1.9-.57.44-.38.65-.88.65-1.52ZM249.47 117.16l2.91-11.64h2.56l-4.56 15.49h-1.88l-4.62-15.49h2.56l3.03 11.64ZM262.87 121.3c-1.91 0-3.38-.57-4.4-1.73-1.02-1.15-1.54-2.84-1.56-5.06v-1.88c0-2.31.5-4.12 1.5-5.43 1-1.31 2.39-1.97 4.18-1.97s3.15.58 4.04 1.73c.89 1.16 1.34 2.95 1.36 5.4v1.66h-8.58v.36c0 1.66.31 2.87.93 3.62.62.75 1.51 1.13 2.68 1.13.74 0 1.39-.14 1.95-.42.56-.28 1.09-.73 1.58-1.34l1.31 1.6c-1.09 1.55-2.75 2.32-4.99 2.32Zm-.28-13.89c-1.04 0-1.81.36-2.32 1.08-.5.72-.79 1.84-.85 3.36h6.05v-.34c-.07-1.47-.33-2.52-.79-3.15s-1.16-.94-2.1-.94ZM277.35 107.9c-.35-.07-.73-.1-1.14-.1-1.29 0-2.19.71-2.7 2.13v11.08H271v-15.49h2.44l.04 1.57c.67-1.24 1.62-1.86 2.86-1.86.4 0 .73.07.99.2v2.46ZM290.99 114.01c0 2.42-.43 4.23-1.29 5.45-.86 1.22-2.11 1.83-3.75 1.83s-2.85-.71-3.67-2.12l-.13 1.83h-2.29V99.01h2.5v8.2c.82-1.33 2.01-1.99 3.55-1.99 1.69 0 2.95.6 3.79 1.8s1.27 3.02 1.28 5.44v1.53Zm-2.5-1.45c0-1.83-.25-3.13-.76-3.91s-1.33-1.17-2.47-1.17c-1.3 0-2.26.71-2.9 2.12v7.36c.63 1.39 1.6 2.09 2.93 2.09 1.14 0 1.95-.4 2.44-1.2s.74-2.05.75-3.73v-1.56ZM302.11 121.02c-.15-.33-.26-.9-.33-1.69-.89 1.32-2.03 1.98-3.41 1.98s-2.48-.39-3.26-1.18-1.17-1.9-1.17-3.33c0-1.57.53-2.82 1.59-3.75 1.06-.93 2.51-1.4 4.36-1.42h1.85v-1.65c0-.93-.2-1.58-.61-1.98-.41-.39-1.03-.59-1.86-.59-.76 0-1.37.23-1.85.68-.47.45-.71 1.03-.71 1.73h-2.51c0-.79.23-1.55.7-2.27a4.83 4.83 0 0 1 1.88-1.7c.79-.41 1.66-.62 2.63-.62 1.57 0 2.77.39 3.59 1.18s1.24 1.94 1.26 3.44v7.82c0 1.19.17 2.23.48 3.11v.23h-2.61Zm-3.35-2.02c.62 0 1.2-.17 1.76-.52s.97-.77 1.22-1.29v-3.69h-1.42c-1.19.02-2.14.29-2.83.81s-1.04 1.25-1.04 2.18c0 .88.18 1.52.53 1.91.35.4.94.59 1.78.59ZM310.51 105.52l.07 1.67c.98-1.31 2.22-1.96 3.74-1.96 2.72 0 4.1 1.83 4.13 5.48V121h-2.5v-10.18c0-1.21-.2-2.07-.6-2.58-.4-.51-1.01-.77-1.81-.77-.63 0-1.19.21-1.68.63-.5.42-.9.97-1.2 1.65V121h-2.51v-15.49h2.37ZM321.69 112.57c0-2.39.44-4.2 1.33-5.45.89-1.25 2.16-1.88 3.82-1.88 1.47 0 2.61.6 3.44 1.8v-8.02h2.51v21.99h-2.3l-.13-1.66c-.82 1.3-2 1.95-3.54 1.95s-2.84-.62-3.74-1.87-1.37-3-1.39-5.28v-1.59Zm2.51 1.44c0 1.74.26 3.01.77 3.83s1.34 1.22 2.5 1.22c1.25 0 2.18-.63 2.8-1.9v-7.81c-.64-1.24-1.57-1.86-2.78-1.86s-1.99.41-2.5 1.22-.77 2.07-.78 3.75V114Z" fill="#ffffff"></path><path d="m164.91 36.37 7.71 24.3 7.71-24.3h4.79v29.78h-3.71v-11.6l.35-11.62-7.73 23.21h-2.84l-7.69-23.13.35 11.53v11.6h-3.71V36.36h4.79ZM193.23 66.15h-3.59V44.02h3.59v22.13ZM204.42 38.66v5.36h3.31v2.92h-3.31v13.74c0 .87.14 1.54.43 1.99s.77.68 1.46.68c.47 0 .95-.08 1.44-.25l-.04 3.05c-.81.27-1.64.41-2.5.41-1.42 0-2.5-.51-3.25-1.53-.74-1.02-1.12-2.47-1.12-4.34V46.95h-3.35v-2.92h3.35v-5.36h3.57ZM216.7 38.66v5.36h3.31v2.92h-3.31v13.74c0 .87.14 1.54.43 1.99s.77.68 1.46.68c.47 0 .95-.08 1.44-.25l-.04 3.05c-.81.27-1.64.41-2.5.41-1.42 0-2.5-.51-3.25-1.53-.74-1.02-1.12-2.47-1.12-4.34V46.95h-3.35v-2.92h3.35v-5.36h3.57ZM231.29 66.56c-2.73 0-4.83-.82-6.29-2.46-1.46-1.64-2.21-4.05-2.23-7.23v-2.68c0-3.3.71-5.89 2.14-7.76 1.43-1.87 3.42-2.81 5.98-2.81s4.49.83 5.76 2.47c1.27 1.65 1.92 4.22 1.95 7.71v2.37h-12.26v.51c0 2.37.44 4.1 1.33 5.17.89 1.08 2.16 1.62 3.83 1.62 1.06 0 1.99-.2 2.79-.6.81-.4 1.56-1.04 2.26-1.91l1.87 2.29c-1.55 2.21-3.93 3.31-7.12 3.31Zm-.41-19.84c-1.49 0-2.59.51-3.31 1.54-.72 1.03-1.12 2.63-1.22 4.8H235v-.49c-.09-2.1-.47-3.6-1.13-4.5-.66-.9-1.65-1.35-2.99-1.35ZM245.95 66.15h-3.59V34.74h3.59v31.41ZM260.6 60.48c0-.78-.29-1.44-.87-2-.58-.56-1.71-1.21-3.37-1.96-1.94-.8-3.3-1.49-4.09-2.07s-1.38-1.22-1.78-1.95c-.39-.73-.59-1.6-.59-2.61 0-1.8.65-3.3 1.96-4.49 1.31-1.19 2.97-1.79 5-1.79 2.14 0 3.86.63 5.16 1.88 1.3 1.25 1.95 2.86 1.95 4.83h-3.57c0-.99-.33-1.84-.99-2.55-.66-.7-1.51-1.05-2.54-1.05s-1.88.28-2.49.83c-.6.55-.9 1.29-.9 2.21 0 .73.22 1.33.66 1.77.44.45 1.5 1.04 3.18 1.77 2.67 1.05 4.48 2.08 5.44 3.08s1.44 2.28 1.44 3.82c0 1.93-.66 3.47-1.97 4.62s-3.07 1.73-5.28 1.73-4.14-.66-5.56-1.98c-1.42-1.32-2.13-3-2.13-5.03h3.61c.04 1.23.41 2.19 1.12 2.88s1.69 1.04 2.96 1.04c1.19 0 2.1-.27 2.72-.81.62-.54.93-1.26.93-2.18ZM273.57 38.66v5.36h3.31v2.92h-3.31v13.74c0 .87.14 1.54.43 1.99s.77.68 1.46.68c.47 0 .95-.08 1.44-.25l-.04 3.05c-.81.27-1.64.41-2.5.41-1.42 0-2.5-.51-3.25-1.53s-1.12-2.47-1.12-4.34V46.95h-3.35v-2.92h3.35v-5.36h3.57ZM291.62 66.15c-.22-.48-.37-1.28-.47-2.41-1.27 1.88-2.9 2.82-4.87 2.82s-3.54-.56-4.66-1.69-1.67-2.71-1.67-4.75c0-2.25.76-4.04 2.27-5.36 1.52-1.32 3.59-2 6.23-2.02h2.64v-2.35c0-1.32-.29-2.26-.87-2.82-.58-.56-1.47-.84-2.66-.84-1.08 0-1.96.32-2.64.97-.68.65-1.01 1.47-1.01 2.46h-3.59c0-1.13.33-2.21.99-3.24a6.887 6.887 0 0 1 2.68-2.42c1.12-.59 2.37-.88 3.76-.88 2.25 0 3.96.56 5.13 1.69s1.77 2.76 1.8 4.92V61.4c.01 1.7.24 3.18.69 4.44v.33h-3.73Zm-4.79-2.88c.88 0 1.72-.25 2.52-.74s1.38-1.1 1.75-1.84v-5.28h-2.03c-1.71.03-3.05.41-4.04 1.16-.99.74-1.48 1.78-1.48 3.12 0 1.25.25 2.16.75 2.73.5.57 1.35.85 2.54.85ZM301.95 44.02l.1 2.39c1.39-1.87 3.17-2.8 5.34-2.8 3.88 0 5.85 2.61 5.91 7.83v14.7h-3.57V51.6c0-1.73-.29-2.96-.86-3.69-.58-.73-1.44-1.09-2.59-1.09-.89 0-1.69.3-2.41.9-.71.6-1.28 1.38-1.72 2.35v16.07h-3.59V44.01h3.39ZM317.1 54.08c0-3.41.63-6.01 1.9-7.79 1.27-1.79 3.08-2.68 5.45-2.68 2.1 0 3.73.86 4.91 2.58V34.74h3.59v31.41h-3.29l-.18-2.37c-1.18 1.85-2.86 2.78-5.05 2.78s-4.06-.89-5.35-2.67-1.95-4.29-1.98-7.54v-2.27Zm3.59 2.05c0 2.48.37 4.3 1.1 5.46.73 1.16 1.92 1.75 3.57 1.75 1.79 0 3.12-.91 4-2.72V49.47c-.92-1.77-2.25-2.66-3.98-2.66s-2.84.58-3.57 1.75-1.1 2.95-1.12 5.36v2.21ZM336.56 62.54h3.59v3.62h-3.59zM189.64 36.37h3.59v3.62h-3.59z" fill="#ffffff"></path><path d="M279.76 90.97h2.6v2.62h-2.6zM257.81 90.97h2.6v2.62h-2.6zM160.12 93.59V72.75h5.9c1.88 0 3.3.46 4.26 1.39.95.93 1.43 2.32 1.43 4.17 0 .97-.24 1.83-.72 2.58s-1.14 1.32-1.96 1.73c.95.29 1.7.87 2.25 1.76s.83 1.96.83 3.21c0 1.87-.51 3.34-1.53 4.41-1.02 1.07-2.47 1.6-4.35 1.6h-6.1Zm2.6-11.95h3.34c.9 0 1.63-.31 2.18-.92.55-.61.83-1.42.83-2.44 0-1.15-.25-1.98-.75-2.5s-1.27-.78-2.3-.78h-3.3v6.64Zm0 2.2v7.5h3.55c.98 0 1.77-.33 2.34-.98.58-.65.87-1.57.87-2.76 0-2.51-1.05-3.77-3.15-3.77h-3.61ZM181.56 89.56l4.73-16.82h2.86l-6.44 20.84h-2.27l-6.42-20.84h2.84l4.7 16.82ZM195.3 72.74l5.4 17.01 5.4-17.01h3.35v20.84h-2.6v-8.12l.24-8.13-5.41 16.25h-1.99l-5.39-16.19.24 8.07v8.12h-2.6V72.74h3.35ZM217.88 87.01l.27 2.33.41-2.06 3.31-14.55h2.17l3.21 14.55.41 2.12.3-2.41 2.53-14.26h2.6l-4.12 20.84h-2.34l-3.45-15.19-.21-1.23-.21 1.23-3.58 15.19h-2.36l-4.11-20.84h2.6L217.88 87ZM250.12 93.87c-1.91 0-3.38-.57-4.4-1.73-1.02-1.15-1.54-2.84-1.56-5.06V85.2c0-2.31.5-4.12 1.5-5.43 1-1.31 2.39-1.97 4.18-1.97s3.15.58 4.04 1.73c.89 1.16 1.34 2.95 1.36 5.4v1.66h-8.58v.36c0 1.66.31 2.87.93 3.62.62.75 1.51 1.13 2.68 1.13.74 0 1.39-.14 1.95-.42.56-.28 1.09-.73 1.58-1.34l1.31 1.6c-1.09 1.55-2.75 2.32-4.99 2.32Zm-.28-13.89c-1.04 0-1.81.36-2.32 1.08-.5.72-.79 1.84-.85 3.36h6.05v-.34c-.07-1.47-.33-2.52-.79-3.15s-1.16-.94-2.1-.94ZM272.17 89.56l4.73-16.82h2.86l-6.44 20.84h-2.27l-6.42-20.84h2.84l4.7 16.82Z" fill="#ffffff"></path></g></g></svg>';
    const pinSvgStringRot =
      '<svg xmlns="http://www.w3.org/2000/svg" width="50" viewBox="0 0 340.16 141.73"><g id="logo_b"><g id="logo_c"><path d="M140.67 72.7c-1.11 38.18-32.18 69.03-70.33 69.03S0 109.99 0 70.85 30.76 1.28 68.52 0v29.81c-21.86.74-38.93 18.83-38.93 41.04s18.24 41.06 40.75 41.06 39.93-17.24 40.72-39.21h29.61ZM74.97.04h29.55v29.77H74.97V.04Zm36.08 36.34h29.55v29.78h-29.55V36.38Zm0-36.34h29.55v29.77h-29.55V.04ZM74.97 36.38h29.55v29.78H74.97V36.38ZM160.12 29.78V0h7.04c3.45 0 6.13 1.09 8.04 3.26 1.91 2.18 2.86 5.23 2.86 9.17v4.99c0 3.94-.97 6.98-2.9 9.13-1.94 2.15-4.74 3.22-8.42 3.22h-6.62Zm3.71-26.57v23.36h2.98c2.61 0 4.52-.75 5.72-2.26 1.2-1.51 1.82-3.74 1.85-6.7v-5.28c0-3.14-.6-5.44-1.8-6.91s-3.01-2.2-5.43-2.2h-3.33ZM190.37 30.19c-2.73 0-4.83-.82-6.29-2.46-1.46-1.64-2.21-4.05-2.23-7.23v-2.68c0-3.3.71-5.89 2.14-7.76 1.43-1.87 3.42-2.81 5.98-2.81s4.49.83 5.76 2.47c1.27 1.65 1.92 4.22 1.95 7.71v2.37h-12.26v.51c0 2.37.44 4.1 1.33 5.17.89 1.08 2.16 1.62 3.83 1.62 1.06 0 1.99-.2 2.79-.6.8-.4 1.56-1.04 2.26-1.91l1.87 2.29c-1.56 2.21-3.93 3.31-7.12 3.31Zm-.41-19.84c-1.49 0-2.59.51-3.31 1.54-.72 1.03-1.12 2.63-1.22 4.8h8.65v-.49c-.09-2.1-.47-3.6-1.13-4.5-.66-.9-1.65-1.35-2.99-1.35ZM210.22 11.04c-.5-.1-1.04-.14-1.62-.14-1.84 0-3.13 1.02-3.86 3.05v15.83h-3.59V7.65h3.49l.06 2.25c.96-1.77 2.32-2.66 4.08-2.66.57 0 1.04.1 1.42.29l.02 3.52Z" fill="#df242b"></path><path d="M160.12 121.02v-20.84h5.9c1.88 0 3.3.46 4.26 1.39.95.93 1.43 2.32 1.43 4.17 0 .97-.24 1.83-.72 2.58s-1.14 1.32-1.96 1.73c.95.29 1.7.87 2.25 1.76s.83 1.96.83 3.21c0 1.87-.51 3.34-1.53 4.41-1.02 1.07-2.47 1.6-4.35 1.6h-6.1Zm2.6-11.95h3.34c.9 0 1.63-.31 2.18-.92.55-.61.83-1.42.83-2.44 0-1.15-.25-1.98-.75-2.5s-1.27-.78-2.3-.78h-3.3v6.64Zm0 2.2v7.5h3.55c.98 0 1.77-.33 2.34-.98.58-.65.87-1.57.87-2.76 0-2.51-1.05-3.77-3.15-3.77h-3.61ZM183.48 119.65c-.83 1.1-2.05 1.65-3.65 1.65-1.39 0-2.44-.48-3.15-1.45s-1.07-2.38-1.08-4.23v-10.09h2.5v9.91c0 2.42.72 3.62 2.16 3.62 1.52 0 2.58-.69 3.15-2.06v-11.47h2.51v15.49h-2.39l-.06-1.36ZM192.08 105.52l.07 1.67c.98-1.31 2.22-1.96 3.74-1.96 2.72 0 4.1 1.83 4.14 5.48V121h-2.5v-10.18c0-1.21-.2-2.07-.6-2.58-.4-.51-1.01-.77-1.81-.77-.63 0-1.19.21-1.68.63-.5.42-.9.97-1.2 1.65V121h-2.51v-15.49h2.37ZM203.26 112.57c0-2.39.44-4.2 1.33-5.45.88-1.25 2.16-1.88 3.82-1.88 1.47 0 2.61.6 3.44 1.8v-8.02h2.51v21.99h-2.3l-.13-1.66c-.82 1.3-2 1.95-3.54 1.95s-2.84-.62-3.74-1.87c-.91-1.25-1.37-3-1.39-5.28v-1.59Zm2.51 1.44c0 1.74.26 3.01.77 3.83s1.34 1.22 2.5 1.22c1.25 0 2.18-.63 2.8-1.9v-7.81c-.64-1.24-1.57-1.86-2.78-1.86s-1.99.41-2.5 1.22-.77 2.07-.78 3.75V114ZM223.72 121.3c-1.91 0-3.38-.57-4.4-1.73-1.02-1.15-1.54-2.84-1.56-5.06v-1.88c0-2.31.5-4.12 1.5-5.43 1-1.31 2.39-1.97 4.18-1.97s3.14.58 4.04 1.73c.89 1.16 1.34 2.95 1.36 5.4v1.66h-8.58v.36c0 1.66.31 2.87.93 3.62.62.75 1.51 1.13 2.68 1.13.74 0 1.39-.14 1.95-.42.56-.28 1.09-.73 1.58-1.34l1.31 1.6c-1.09 1.55-2.75 2.32-4.99 2.32Zm-.28-13.89c-1.04 0-1.81.36-2.32 1.08-.5.72-.79 1.84-.85 3.36h6.05v-.34c-.07-1.47-.33-2.52-.79-3.15-.46-.63-1.16-.94-2.1-.94ZM239.32 117.05c0-.54-.2-1.01-.61-1.4-.41-.39-1.19-.85-2.36-1.37-1.35-.56-2.31-1.05-2.86-1.45s-.97-.86-1.24-1.37c-.28-.51-.41-1.12-.41-1.83 0-1.26.46-2.31 1.37-3.14.91-.83 2.08-1.25 3.5-1.25 1.5 0 2.7.44 3.61 1.32.91.88 1.36 2 1.36 3.38h-2.5c0-.7-.23-1.29-.7-1.78-.46-.49-1.06-.74-1.78-.74s-1.32.19-1.74.58c-.42.39-.63.9-.63 1.55 0 .51.15.93.46 1.24s1.05.73 2.22 1.24c1.87.74 3.14 1.46 3.81 2.16s1.01 1.59 1.01 2.67c0 1.35-.46 2.43-1.38 3.23-.92.81-2.15 1.21-3.69 1.21s-2.9-.46-3.89-1.39c-.99-.93-1.49-2.1-1.49-3.52h2.53c.03.86.29 1.53.78 2.02s1.18.73 2.07.73c.83 0 1.47-.19 1.9-.57.44-.38.65-.88.65-1.52ZM249.47 117.16l2.91-11.64h2.56l-4.56 15.49h-1.88l-4.62-15.49h2.56l3.03 11.64ZM262.87 121.3c-1.91 0-3.38-.57-4.4-1.73-1.02-1.15-1.54-2.84-1.56-5.06v-1.88c0-2.31.5-4.12 1.5-5.43 1-1.31 2.39-1.97 4.18-1.97s3.15.58 4.04 1.73c.89 1.16 1.34 2.95 1.36 5.4v1.66h-8.58v.36c0 1.66.31 2.87.93 3.62.62.75 1.51 1.13 2.68 1.13.74 0 1.39-.14 1.95-.42.56-.28 1.09-.73 1.58-1.34l1.31 1.6c-1.09 1.55-2.75 2.32-4.99 2.32Zm-.28-13.89c-1.04 0-1.81.36-2.32 1.08-.5.72-.79 1.84-.85 3.36h6.05v-.34c-.07-1.47-.33-2.52-.79-3.15s-1.16-.94-2.1-.94ZM277.35 107.9c-.35-.07-.73-.1-1.14-.1-1.29 0-2.19.71-2.7 2.13v11.08H271v-15.49h2.44l.04 1.57c.67-1.24 1.62-1.86 2.86-1.86.4 0 .73.07.99.2v2.46ZM290.99 114.01c0 2.42-.43 4.23-1.29 5.45-.86 1.22-2.11 1.83-3.75 1.83s-2.85-.71-3.67-2.12l-.13 1.83h-2.29V99.01h2.5v8.2c.82-1.33 2.01-1.99 3.55-1.99 1.69 0 2.95.6 3.79 1.8s1.27 3.02 1.28 5.44v1.53Zm-2.5-1.45c0-1.83-.25-3.13-.76-3.91s-1.33-1.17-2.47-1.17c-1.3 0-2.26.71-2.9 2.12v7.36c.63 1.39 1.6 2.09 2.93 2.09 1.14 0 1.95-.4 2.44-1.2s.74-2.05.75-3.73v-1.56ZM302.11 121.02c-.15-.33-.26-.9-.33-1.69-.89 1.32-2.03 1.98-3.41 1.98s-2.48-.39-3.26-1.18-1.17-1.9-1.17-3.33c0-1.57.53-2.82 1.59-3.75 1.06-.93 2.51-1.4 4.36-1.42h1.85v-1.65c0-.93-.2-1.58-.61-1.98-.41-.39-1.03-.59-1.86-.59-.76 0-1.37.23-1.85.68-.47.45-.71 1.03-.71 1.73h-2.51c0-.79.23-1.55.7-2.27a4.83 4.83 0 0 1 1.88-1.7c.79-.41 1.66-.62 2.63-.62 1.57 0 2.77.39 3.59 1.18s1.24 1.94 1.26 3.44v7.82c0 1.19.17 2.23.48 3.11v.23h-2.61Zm-3.35-2.02c.62 0 1.2-.17 1.76-.52s.97-.77 1.22-1.29v-3.69h-1.42c-1.19.02-2.14.29-2.83.81s-1.04 1.25-1.04 2.18c0 .88.18 1.52.53 1.91.35.4.94.59 1.78.59ZM310.51 105.52l.07 1.67c.98-1.31 2.22-1.96 3.74-1.96 2.72 0 4.1 1.83 4.13 5.48V121h-2.5v-10.18c0-1.21-.2-2.07-.6-2.58-.4-.51-1.01-.77-1.81-.77-.63 0-1.19.21-1.68.63-.5.42-.9.97-1.2 1.65V121h-2.51v-15.49h2.37ZM321.69 112.57c0-2.39.44-4.2 1.33-5.45.89-1.25 2.16-1.88 3.82-1.88 1.47 0 2.61.6 3.44 1.8v-8.02h2.51v21.99h-2.3l-.13-1.66c-.82 1.3-2 1.95-3.54 1.95s-2.84-.62-3.74-1.87-1.37-3-1.39-5.28v-1.59Zm2.51 1.44c0 1.74.26 3.01.77 3.83s1.34 1.22 2.5 1.22c1.25 0 2.18-.63 2.8-1.9v-7.81c-.64-1.24-1.57-1.86-2.78-1.86s-1.99.41-2.5 1.22-.77 2.07-.78 3.75V114Z" fill="#6f7271"></path><path d="m164.91 36.37 7.71 24.3 7.71-24.3h4.79v29.78h-3.71v-11.6l.35-11.62-7.73 23.21h-2.84l-7.69-23.13.35 11.53v11.6h-3.71V36.36h4.79ZM193.23 66.15h-3.59V44.02h3.59v22.13ZM204.42 38.66v5.36h3.31v2.92h-3.31v13.74c0 .87.14 1.54.43 1.99s.77.68 1.46.68c.47 0 .95-.08 1.44-.25l-.04 3.05c-.81.27-1.64.41-2.5.41-1.42 0-2.5-.51-3.25-1.53-.74-1.02-1.12-2.47-1.12-4.34V46.95h-3.35v-2.92h3.35v-5.36h3.57ZM216.7 38.66v5.36h3.31v2.92h-3.31v13.74c0 .87.14 1.54.43 1.99s.77.68 1.46.68c.47 0 .95-.08 1.44-.25l-.04 3.05c-.81.27-1.64.41-2.5.41-1.42 0-2.5-.51-3.25-1.53-.74-1.02-1.12-2.47-1.12-4.34V46.95h-3.35v-2.92h3.35v-5.36h3.57ZM231.29 66.56c-2.73 0-4.83-.82-6.29-2.46-1.46-1.64-2.21-4.05-2.23-7.23v-2.68c0-3.3.71-5.89 2.14-7.76 1.43-1.87 3.42-2.81 5.98-2.81s4.49.83 5.76 2.47c1.27 1.65 1.92 4.22 1.95 7.71v2.37h-12.26v.51c0 2.37.44 4.1 1.33 5.17.89 1.08 2.16 1.62 3.83 1.62 1.06 0 1.99-.2 2.79-.6.81-.4 1.56-1.04 2.26-1.91l1.87 2.29c-1.55 2.21-3.93 3.31-7.12 3.31Zm-.41-19.84c-1.49 0-2.59.51-3.31 1.54-.72 1.03-1.12 2.63-1.22 4.8H235v-.49c-.09-2.1-.47-3.6-1.13-4.5-.66-.9-1.65-1.35-2.99-1.35ZM245.95 66.15h-3.59V34.74h3.59v31.41ZM260.6 60.48c0-.78-.29-1.44-.87-2-.58-.56-1.71-1.21-3.37-1.96-1.94-.8-3.3-1.49-4.09-2.07s-1.38-1.22-1.78-1.95c-.39-.73-.59-1.6-.59-2.61 0-1.8.65-3.3 1.96-4.49 1.31-1.19 2.97-1.79 5-1.79 2.14 0 3.86.63 5.16 1.88 1.3 1.25 1.95 2.86 1.95 4.83h-3.57c0-.99-.33-1.84-.99-2.55-.66-.7-1.51-1.05-2.54-1.05s-1.88.28-2.49.83c-.6.55-.9 1.29-.9 2.21 0 .73.22 1.33.66 1.77.44.45 1.5 1.04 3.18 1.77 2.67 1.05 4.48 2.08 5.44 3.08s1.44 2.28 1.44 3.82c0 1.93-.66 3.47-1.97 4.62s-3.07 1.73-5.28 1.73-4.14-.66-5.56-1.98c-1.42-1.32-2.13-3-2.13-5.03h3.61c.04 1.23.41 2.19 1.12 2.88s1.69 1.04 2.96 1.04c1.19 0 2.1-.27 2.72-.81.62-.54.93-1.26.93-2.18ZM273.57 38.66v5.36h3.31v2.92h-3.31v13.74c0 .87.14 1.54.43 1.99s.77.68 1.46.68c.47 0 .95-.08 1.44-.25l-.04 3.05c-.81.27-1.64.41-2.5.41-1.42 0-2.5-.51-3.25-1.53s-1.12-2.47-1.12-4.34V46.95h-3.35v-2.92h3.35v-5.36h3.57ZM291.62 66.15c-.22-.48-.37-1.28-.47-2.41-1.27 1.88-2.9 2.82-4.87 2.82s-3.54-.56-4.66-1.69-1.67-2.71-1.67-4.75c0-2.25.76-4.04 2.27-5.36 1.52-1.32 3.59-2 6.23-2.02h2.64v-2.35c0-1.32-.29-2.26-.87-2.82-.58-.56-1.47-.84-2.66-.84-1.08 0-1.96.32-2.64.97-.68.65-1.01 1.47-1.01 2.46h-3.59c0-1.13.33-2.21.99-3.24a6.887 6.887 0 0 1 2.68-2.42c1.12-.59 2.37-.88 3.76-.88 2.25 0 3.96.56 5.13 1.69s1.77 2.76 1.8 4.92V61.4c.01 1.7.24 3.18.69 4.44v.33h-3.73Zm-4.79-2.88c.88 0 1.72-.25 2.52-.74s1.38-1.1 1.75-1.84v-5.28h-2.03c-1.71.03-3.05.41-4.04 1.16-.99.74-1.48 1.78-1.48 3.12 0 1.25.25 2.16.75 2.73.5.57 1.35.85 2.54.85ZM301.95 44.02l.1 2.39c1.39-1.87 3.17-2.8 5.34-2.8 3.88 0 5.85 2.61 5.91 7.83v14.7h-3.57V51.6c0-1.73-.29-2.96-.86-3.69-.58-.73-1.44-1.09-2.59-1.09-.89 0-1.69.3-2.41.9-.71.6-1.28 1.38-1.72 2.35v16.07h-3.59V44.01h3.39ZM317.1 54.08c0-3.41.63-6.01 1.9-7.79 1.27-1.79 3.08-2.68 5.45-2.68 2.1 0 3.73.86 4.91 2.58V34.74h3.59v31.41h-3.29l-.18-2.37c-1.18 1.85-2.86 2.78-5.05 2.78s-4.06-.89-5.35-2.67-1.95-4.29-1.98-7.54v-2.27Zm3.59 2.05c0 2.48.37 4.3 1.1 5.46.73 1.16 1.92 1.75 3.57 1.75 1.79 0 3.12-.91 4-2.72V49.47c-.92-1.77-2.25-2.66-3.98-2.66s-2.84.58-3.57 1.75-1.1 2.95-1.12 5.36v2.21ZM336.56 62.54h3.59v3.62h-3.59zM189.64 36.37h3.59v3.62h-3.59z" fill="#df242b"></path><path d="M279.76 90.97h2.6v2.62h-2.6zM257.81 90.97h2.6v2.62h-2.6zM160.12 93.59V72.75h5.9c1.88 0 3.3.46 4.26 1.39.95.93 1.43 2.32 1.43 4.17 0 .97-.24 1.83-.72 2.58s-1.14 1.32-1.96 1.73c.95.29 1.7.87 2.25 1.76s.83 1.96.83 3.21c0 1.87-.51 3.34-1.53 4.41-1.02 1.07-2.47 1.6-4.35 1.6h-6.1Zm2.6-11.95h3.34c.9 0 1.63-.31 2.18-.92.55-.61.83-1.42.83-2.44 0-1.15-.25-1.98-.75-2.5s-1.27-.78-2.3-.78h-3.3v6.64Zm0 2.2v7.5h3.55c.98 0 1.77-.33 2.34-.98.58-.65.87-1.57.87-2.76 0-2.51-1.05-3.77-3.15-3.77h-3.61ZM181.56 89.56l4.73-16.82h2.86l-6.44 20.84h-2.27l-6.42-20.84h2.84l4.7 16.82ZM195.3 72.74l5.4 17.01 5.4-17.01h3.35v20.84h-2.6v-8.12l.24-8.13-5.41 16.25h-1.99l-5.39-16.19.24 8.07v8.12h-2.6V72.74h3.35ZM217.88 87.01l.27 2.33.41-2.06 3.31-14.55h2.17l3.21 14.55.41 2.12.3-2.41 2.53-14.26h2.6l-4.12 20.84h-2.34l-3.45-15.19-.21-1.23-.21 1.23-3.58 15.19h-2.36l-4.11-20.84h2.6L217.88 87ZM250.12 93.87c-1.91 0-3.38-.57-4.4-1.73-1.02-1.15-1.54-2.84-1.56-5.06V85.2c0-2.31.5-4.12 1.5-5.43 1-1.31 2.39-1.97 4.18-1.97s3.15.58 4.04 1.73c.89 1.16 1.34 2.95 1.36 5.4v1.66h-8.58v.36c0 1.66.31 2.87.93 3.62.62.75 1.51 1.13 2.68 1.13.74 0 1.39-.14 1.95-.42.56-.28 1.09-.73 1.58-1.34l1.31 1.6c-1.09 1.55-2.75 2.32-4.99 2.32Zm-.28-13.89c-1.04 0-1.81.36-2.32 1.08-.5.72-.79 1.84-.85 3.36h6.05v-.34c-.07-1.47-.33-2.52-.79-3.15s-1.16-.94-2.1-.94ZM272.17 89.56l4.73-16.82h2.86l-6.44 20.84h-2.27l-6.42-20.84h2.84l4.7 16.82Z" fill="#6f7271"></path></g></g></svg>';
      let pinSvg = null;
      if(position.pop < 19999){
        pinSvg = parser.parseFromString(
          pinSvgStringWeis,
          "image/svg+xml",
        ).documentElement;
  
      } else {
        pinSvg = parser.parseFromString(
          pinSvgStringRot,
          "image/svg+xml",
        ).documentElement;
      }
    
    const marker = new google.maps.marker.AdvancedMarkerElement({
      content: pinSvg,
      position,
      //content: pTag,
    });

    // markers can only be keyboard focusable when they have click listeners
    // open info window when marker is clicked
    marker.addListener("click", () => {
      infoWindow.close();
      infoWindow.setContent(contentString);
      infoWindow.open(map, marker);
      toggleZ(marker);
    });
    return marker;
  });
console.log(markers);
  let renderer = {
      render: ({ count, position, markers }) =>

      new google.maps.Marker({
              label: {
                  text: String(count),
                  color: "aliceblue",
              },
              position,
              icon: {
                  url: `https://cdn.rawgit.com/googlemaps/js-marker-clusterer/gh-pages/images/m3.png`,
                },
              // adjust zIndex to be above other markers
              zIndex: Number(google.maps.Marker.MAX_ZINDEX) + count,
              }),
  };

  let algorithm = new markerClusterer.GridAlgorithm({gridSize: 90});
  //const algorithm = new markerClusterer.SuperClusterAlgorithm({ maxZoom: 12, radius: 80});
  let config = { map, markers, renderer, algorithm };

  
  //let config = { map, markers, renderer };
  //let cluster = new markerClusterer.MarkerClusterer(config);

  // Add a marker clusterer to manage the markers.
  const markerCluster = new markerClusterer.MarkerClusterer(
    config
  );

}

function toggleZ(markerV){
  document.querySelectorAll(".pTag").forEach(function(x){
    x.classList.remove("highlight");
    x.parentNode.parentNode.style.zIndex = null;
    x.parentNode.parentNode.style.fontSize = "1em";
  });
  if (markerV.content.classList.contains("highlight")) {
    markerV.content.classList.remove("highlight");
    markerV.zIndex = null;
  } else {
    markerV.content.classList.add("highlight");
    markerV.zIndex = 999;
  }
}

// Example POST method implementation:
async function postData(url = "") {
  // Default options are marked with *
  const response = await fetch(url, {
    method: "GET", // *GET, POST, PUT, DELETE, etc.
    
  });
  return response.json(); // parses JSON response into native JavaScript objects
}

const dl_staetdte = "https://raw.githubusercontent.com/pensnarik/german-cities/master/germany.json";

postData(dl_staetdte).then((data) => {
  console.log(data); // JSON data parsed by `data.json()` call
  initMap(data);

});